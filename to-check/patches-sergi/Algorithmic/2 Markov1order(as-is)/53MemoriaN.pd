#N canvas 145 30 1412 726 16;
#X obj 155 322 table lastN;
#X msg 157 186 \; lastN resize \$1;
#X floatatom 157 110 5 0 0 0 - - -;
#X text 153 83 tamaño memoria;
#X obj 396 130 random 100;
#X obj 396 167 % 12;
#X obj 463 229 f;
#X obj 463 264 + 1;
#X obj 463 377 % 8;
#X obj 183 153 s N;
#X obj 505 264 r N;
#X obj 386 479 tabwrite lastN;
#X obj 386 448 pack 1 1;
#X msg 396 101 bang;
#X obj 396 198 t b f b;
#N canvas 42 5 979 701 llenartotalnotas 0;
#X obj 86 13 inlet;
#X obj 194 18 r N;
#X msg 172 112 \; totalnotasinc const 0;
#X obj 86 159 f;
#X obj 86 49 t b b b;
#X obj 86 203 + 1;
#X obj 86 287 tabread lastN;
#X obj 86 245 moses;
#X msg 21 21 bang;
#X msg 119 127 -1;
#X obj 86 361 % 12;
#X text -120 241 entra una nota;
#X obj 119 551 pack 1 1;
#X obj 119 462 i;
#X obj 119 490 + 1;
#X obj -468 340 s contadores;
#X msg -468 311 0;
#X obj -484 8 loadbang;
#X obj -469 384 table totalnotas;
#X msg -495 85 \; totalnotas resize 12;
#X msg -495 182 \; totalnotas const 0;
#X obj 119 434 tabread totalnotas;
#X obj 119 580 tabwrite totalnotas;
#X obj 119 520 / 1;
#N canvas 40 0 986 711 sumaynormal 0;
#X obj -482 2 inlet;
#X msg -5 80 0;
#X msg -49 80 1;
#X msg -92 80 2;
#X msg -135 80 3;
#X msg -180 80 4;
#X msg -223 80 5;
#X msg -266 80 6;
#X msg -310 79 7;
#X msg -354 79 8;
#X msg -398 79 9;
#X msg -440 79 10;
#X msg -482 78 11;
#X obj -49 168 +;
#X obj -5 102 tabread totalnotas;
#X obj -49 146 tabread totalnotas;
#X obj -482 29 t b b b b b b b b b b b b;
#X msg -22 211 \$1 1;
#X obj -49 191 t f f;
#X obj 23 189 tabwrite totalnotasinc;
#X obj -5 124 t f f;
#X msg 23 167 \$1 0;
#X obj -22 233 tabwrite totalnotasinc;
#X obj -91 277 +;
#X obj -91 255 tabread totalnotas;
#X obj -91 299 t f f;
#X obj -64 343 tabwrite totalnotasinc;
#X msg -64 321 \$1 2;
#X obj -135 384 +;
#X obj -135 363 tabread totalnotas;
#X obj -135 406 t f f;
#X obj -108 447 tabwrite totalnotasinc;
#X msg -108 426 \$1 3;
#X obj -180 489 +;
#X obj -180 467 tabread totalnotas;
#X obj -180 511 t f f;
#X obj -153 555 tabwrite totalnotasinc;
#X msg -153 534 \$1 4;
#X obj -223 600 +;
#X obj -223 578 tabread totalnotas;
#X obj -223 622 t f f;
#X obj -196 666 tabwrite totalnotasinc;
#X msg -196 645 \$1 5;
#X obj -266 124 +;
#X obj -266 102 tabread totalnotas;
#X obj -266 146 t f f;
#X obj -239 190 tabwrite totalnotasinc;
#X msg -239 169 \$1 6;
#X obj -310 233 +;
#X obj -310 211 tabread totalnotas;
#X obj -310 255 t f f;
#X obj -283 299 tabwrite totalnotasinc;
#X msg -283 278 \$1 7;
#X obj -354 342 +;
#X obj -354 320 tabread totalnotas;
#X obj -354 364 t f f;
#X obj -327 408 tabwrite totalnotasinc;
#X msg -327 387 \$1 8;
#X obj -398 453 +;
#X obj -398 431 tabread totalnotas;
#X obj -398 475 t f f;
#X obj -371 519 tabwrite totalnotasinc;
#X msg -371 498 \$1 9;
#X obj -440 563 +;
#X obj -440 541 tabread totalnotas;
#X obj -440 585 t f f;
#X obj -413 629 tabwrite totalnotasinc;
#X msg -413 608 \$1 10;
#X obj -482 135 +;
#X obj -482 113 tabread totalnotas;
#X obj -455 201 tabwrite totalnotasinc;
#X msg -455 180 \$1 11;
#X msg -482 239 \; totalnotasinc normalize;
#X obj -482 157 t b f;
#X connect 0 0 16 0;
#X connect 1 0 14 0;
#X connect 2 0 15 0;
#X connect 3 0 24 0;
#X connect 4 0 29 0;
#X connect 5 0 34 0;
#X connect 6 0 39 0;
#X connect 7 0 44 0;
#X connect 8 0 49 0;
#X connect 9 0 54 0;
#X connect 10 0 59 0;
#X connect 11 0 64 0;
#X connect 12 0 69 0;
#X connect 13 0 18 0;
#X connect 14 0 20 0;
#X connect 15 0 13 0;
#X connect 16 0 12 0;
#X connect 16 1 11 0;
#X connect 16 2 10 0;
#X connect 16 3 9 0;
#X connect 16 4 8 0;
#X connect 16 5 7 0;
#X connect 16 6 6 0;
#X connect 16 7 5 0;
#X connect 16 8 4 0;
#X connect 16 9 3 0;
#X connect 16 10 2 0;
#X connect 16 11 1 0;
#X connect 17 0 22 0;
#X connect 18 0 23 1;
#X connect 18 1 17 0;
#X connect 20 0 13 1;
#X connect 20 1 21 0;
#X connect 21 0 19 0;
#X connect 23 0 25 0;
#X connect 24 0 23 0;
#X connect 25 0 28 1;
#X connect 25 1 27 0;
#X connect 27 0 26 0;
#X connect 28 0 30 0;
#X connect 29 0 28 0;
#X connect 30 0 33 1;
#X connect 30 1 32 0;
#X connect 32 0 31 0;
#X connect 33 0 35 0;
#X connect 34 0 33 0;
#X connect 35 0 38 1;
#X connect 35 1 37 0;
#X connect 37 0 36 0;
#X connect 38 0 40 0;
#X connect 39 0 38 0;
#X connect 40 0 43 1;
#X connect 40 1 42 0;
#X connect 42 0 41 0;
#X connect 43 0 45 0;
#X connect 44 0 43 0;
#X connect 45 0 48 1;
#X connect 45 1 47 0;
#X connect 47 0 46 0;
#X connect 48 0 50 0;
#X connect 49 0 48 0;
#X connect 50 0 53 1;
#X connect 50 1 52 0;
#X connect 52 0 51 0;
#X connect 53 0 55 0;
#X connect 54 0 53 0;
#X connect 55 0 58 1;
#X connect 55 1 57 0;
#X connect 57 0 56 0;
#X connect 58 0 60 0;
#X connect 59 0 58 0;
#X connect 60 0 63 1;
#X connect 60 1 62 0;
#X connect 62 0 61 0;
#X connect 63 0 65 0;
#X connect 64 0 63 0;
#X connect 65 0 68 1;
#X connect 65 1 67 0;
#X connect 67 0 66 0;
#X connect 68 0 73 0;
#X connect 69 0 68 0;
#X connect 71 0 70 0;
#X connect 73 0 72 0;
#X connect 73 1 71 0;
#X restore -478 570 pd sumaynormal;
#X obj -468 413 table totalnotasinc;
#X msg -496 133 \; totalnotasinc resize 12;
#X msg -493 231 \; totalnotasinc const 0;
#X text -480 604 una vez se ha incrementado el valor actual \, en la
tabla de contadores \, se van añadiendo los valores de cada índice
\, de forma que la última pos (11) contenga la suma de todas las anteriores.
Después normalizamos a 1 (de forma que la última pos. valdrá 1);
#X obj 86 398 t b f f;
#X obj 86 320 t f b;
#X connect 0 0 4 0;
#X connect 1 0 7 1;
#X connect 3 0 5 0;
#X connect 4 0 3 0;
#X connect 4 1 9 0;
#X connect 4 2 2 0;
#X connect 5 0 3 1;
#X connect 5 0 7 0;
#X connect 6 0 30 0;
#X connect 7 0 6 0;
#X connect 8 0 4 0;
#X connect 9 0 3 1;
#X connect 10 0 29 0;
#X connect 12 0 22 0;
#X connect 13 0 14 0;
#X connect 14 0 13 1;
#X connect 14 0 23 0;
#X connect 16 0 15 0;
#X connect 17 0 19 0;
#X connect 17 0 20 0;
#X connect 17 0 16 0;
#X connect 17 0 26 0;
#X connect 17 0 27 0;
#X connect 21 0 13 0;
#X connect 23 0 12 0;
#X connect 29 0 24 0;
#X connect 29 1 21 0;
#X connect 29 2 12 1;
#X connect 30 0 10 0;
#X restore 221 411 pd llenartotalnotas;
#X obj 330 102 inlet;
#X msg 157 233 \; lastN const 0;
#X text 556 95 este patch \, pretende ampliar algunos de los conceptos
desarrollados en los ejemplos anteriores. uno de los principales problemas
del patch anterior era que la tabla se iba llenando permanentemente
\, con lo cual \, al final probablemente la tabla quedaría con 12 distribuciones
casi equiprobables. para solucionar esto \, proponemos tener una ventana
temporal que tenga en cuenta solo los N ultimos eventos (notas) recibidos.
primero \, definimos el tamaño de esta ventana o memoria temporal y
creamos una tabla de este tamaño \, que se irá llenando (FIFO) con
las notas que llegan. para crear una cola FIFO usamos un contador con
MODULO N. NB. tabwrite espera (valor \, indice) en este orden a cada
nueva nota que entra en la cola \, leemos toda la tabla \, y hacemos
un proceso similar al del patch anterior (contenido todo en llenartotalnotas)
;
#X connect 2 0 1 0;
#X connect 2 0 9 0;
#X connect 2 0 17 0;
#X connect 4 0 5 0;
#X connect 5 0 14 0;
#X connect 6 0 7 0;
#X connect 7 0 6 1;
#X connect 7 0 8 0;
#X connect 8 0 12 1;
#X connect 10 0 8 1;
#X connect 12 0 11 0;
#X connect 13 0 4 0;
#X connect 14 0 15 0;
#X connect 14 1 12 0;
#X connect 14 2 6 0;
#X connect 16 0 5 0;
